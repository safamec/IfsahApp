@model IfsahApp.Core.ViewModels.DisclosureFormViewModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@using Microsoft.AspNetCore.Mvc.Rendering
@{
    ViewData["Title"] = Localizer["Review Disclosure"];
    ViewData["Step"]  = Model.Step;

    // Controller should call: await LoadDisclosureTypesAsync(Model.DisclosureTypeId);
    var types = ViewBag.DisclosureTypes as IEnumerable<SelectListItem> ?? Enumerable.Empty<SelectListItem>();
    var disclosureTypeText = types.FirstOrDefault(t => t.Value == Model.DisclosureTypeId.ToString())?.Text
                             ?? Model.DisclosureTypeId.ToString();
}

@section StepTabs { @await Html.PartialAsync("_DisclosureTabs") }

<h2>@ViewData["Title"]</h2>

<!-- Disclosure Details -->
<div class="mb-4">
    <h4>@Localizer["Disclosure Details"]</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>@Localizer["Disclosure Type"]</th>
                <th>@Localizer["Description"]</th>
                <th>@Localizer["Location"]</th>
                <th>@Localizer["Incident Start Date"]</th>
                <th>@Localizer["Incident End Date"]</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>@disclosureTypeText</td>
                <td>@Model.Description</td>
                <td>@Model.Location</td>
                <td>@Model.IncidentStartDate?.ToString("yyyy-MM-dd")</td>
                <td>@Model.IncidentEndDate?.ToString("yyyy-MM-dd")</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Suspected People -->
<div class="mb-4">
    <h4>@Localizer["Suspected People"]</h4>
    @if (Model.SuspectedPersons?.Any() == true)
    {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>@Localizer["Name"]</th>
                    <th>@Localizer["Email"]</th>
                    <th>@Localizer["Phone"]</th>
                    <th>@Localizer["Organization"]</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var sp in Model.SuspectedPersons)
                {
                    <tr>
                        <td>@sp.Name</td>
                        <td>@sp.Email</td>
                        <td>@sp.Phone</td>
                        <td>@sp.Organization</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-muted">@Localizer["No suspected people"]</p>
    }
</div>

<!-- Related People -->
<div class="mb-4">
    <h4>@Localizer["Related People"]</h4>
    @if (Model.RelatedPersons?.Any() == true)
    {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>@Localizer["Name"]</th>
                    <th>@Localizer["Email"]</th>
                    <th>@Localizer["Phone"]</th>
                    <th>@Localizer["Organization"]</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var rp in Model.RelatedPersons)
                {
                    <tr>
                        <td>@rp.Name</td>
                        <td>@rp.Email</td>
                        <td>@rp.Phone</td>
                        <td>@rp.Organization</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-muted">@Localizer["No related people"]</p>
    }
</div>

<!-- Attachments (from TempData via Model.SavedAttachmentPaths) -->
<div class="mb-4">
    <h4>@Localizer["Attachments"]</h4>
    @if (Model.SavedAttachmentPaths?.Any() == true)
    {
        <ul class="list-unstyled mb-0">
            @foreach (var name in Model.SavedAttachmentPaths)
            {
                <li><a href="~/tempUploads/@name" target="_blank">@name</a></li>
            }
        </ul>
    }
    else
    {
        <p class="text-muted">@Localizer["No attachments"]</p>
    }
</div>

<form asp-action="ReviewForm" method="post">
    @Html.AntiForgeryToken()
    <div class="d-flex justify-content-between mt-3">
        <a asp-action="Attachments" class="btn btn-secondary">@Localizer["Back"]</a>
        <button type="submit" class="btn btn-success">@Localizer["Submit Disclosure"]</button>
    </div>
</form>
