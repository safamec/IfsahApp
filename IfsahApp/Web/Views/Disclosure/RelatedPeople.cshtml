@model IfsahApp.Core.ViewModels.DisclosureFormViewModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Related People"];
    ViewData["Step"]  = 3;
    var related = Model.RelatedPersons ?? new List<IfsahApp.Core.Models.RelatedPerson>();
}

@section StepTabs { @await Html.PartialAsync("_DisclosureTabs") }

<h2>@ViewData["Title"]</h2>

<form asp-action="RelatedPeople" method="post" id="relatedForm">
    <div class="mb-3">
        <label class="form-label fw-bold">@Localizer["Related People"]</label>

        <div>
            <button id="btnAddPerson"
                    type="button"
                    class="btn btn-outline-primary btn-sm mt-2"
                    data-type="Related">
                @Localizer["Add Related Person"]
            </button>
        </div>

        <div class="mt-3">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>@Localizer["Name"]</th>
                    <th>@Localizer["Email"]</th>
                    <th>@Localizer["Phone"]</th>
                    <th>@Localizer["Organization"]</th>
                    <th style="width:40px;"></th>
                </tr>
                </thead>
                <tbody id="peopleList">
                @for (int i = 0; i < related.Count; i++)
                {
                    <tr>
                        <td>@related[i].Name
                            <input type="hidden" name="RelatedPersons[@i].Name" value="@related[i].Name" />
                        </td>
                        <td>@related[i].Email
                            <input type="hidden" name="RelatedPersons[@i].Email" value="@related[i].Email" />
                        </td>
                        <td>@related[i].Phone
                            <input type="hidden" name="RelatedPersons[@i].Phone" value="@related[i].Phone" />
                        </td>
                        <td>@related[i].Organization
                            <input type="hidden" name="RelatedPersons[@i].Organization" value="@related[i].Organization" />
                        </td>
                        <td class="text-center">
                            <button type="button" class="btn btn-link p-0 text-danger fw-bold" data-delete-row>&#10006;</button>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>

    <div class="d-flex justify-content-between mt-3">
        <button type="submit" name="submitDir" value="back" class="btn btn-secondary">@Localizer["Back"]</button>
        <button type="submit" class="btn btn-primary">@Localizer["Next"]</button>
    </div>
</form>

<div class="modal fade" id="personModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content"><div class="modal-body"></div></div></div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/people-modal.js"></script>
    <script>
      window.initPeopleModal({
        buttonId:   "btnAddPerson",
        listId:     "peopleList",
        modalId:    "personModal",
        prefix:     "RelatedPersons"
      });
    </script>
}
