@* _Navbar.cshtml *@
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

<ul class="navbar-nav">

    <!-- Dev login (visible when not authenticated) -->
    <li class="nav-item">
        <a class="nav-link" asp-controller="DevLogin" asp-action="Index">
            <i class="bi bi-box-arrow-in-right me-1"></i>
            Login
        </a>
    </li>

    <!-- User dropdown (you can toggle display via JS/auth) -->
    <li class="nav-item dropdown" id="user-nav" style="display: none;">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle me-1"></i>
            <span>@Localizer["user"]</span>
        </a>
        <ul class="dropdown-menu">
            <li>
                <a class="dropdown-item" href="#">
                    <i class="bi bi-person me-2"></i>
                    <span>@Localizer["profile"]</span>
                </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
                <a class="dropdown-item" href="#">
                    <i class="bi bi-box-arrow-right me-2"></i>
                    <span>@Localizer["logout"]</span>
                </a>
            </li>
        </ul>
    </li>

    <!-- Help -->
    <li class="nav-item">
        <a class="nav-link" href="#">
            <i class="bi bi-question-circle me-1"></i>
            <span>@Localizer["help"]</span>
        </a>
    </li>

   <!-- Notifications bell (navbar item) -->
<li class="nav-item dropdown">
  <a id="btnNotif"
     class="nav-link dropdown-toggle position-relative"
     href="#"
     role="button"
     data-bs-toggle="dropdown"
     aria-expanded="false">
    <i class="bi bi-bell fs-5"></i>
    <span id="notifBadge"
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
  </a>

  <!-- منع الإغلاق عند التفاعل داخل القائمة -->
<ul class="dropdown-menu dropdown-menu-end shadow"
    data-bs-auto-close="outside"
    aria-labelledby="btnNotif"
    style="min-width:340px;max-height:380px;overflow:auto;">

    <!-- رأس القائمة -->
    <li class="px-3 pt-2 pb-1 d-flex justify-content-between align-items-center">
      <strong>الإشعارات</strong>

      <!-- زر تعيين الكل كمقروء عبر POST + AntiForgery -->
      <form id="notifMarkAllForm" method="post" action="/Notifications/MarkAllRead" class="m-0 p-0">
        @Html.AntiForgeryToken()
        <button id="notifMarkAll" class="btn btn-sm btn-outline-secondary" type="submit">
          تعيين مقروءة
        </button>
      </form>
    </li>

    <li><hr class="dropdown-divider"></li>

    <!-- قائمة الإشعارات تُملأ بالـ JS -->
    <li id="notifList">
      <div class="text-center text-muted py-3">لا توجد إشعارات</div>
    </li>
  </ul>
</li>


    <!-- Theme toggle -->
    <li class="nav-item p-2">
        <label class="toggle-theme">
            <input type="checkbox" id="theme-checkbox">
            <span class="slider"></span>
        </label>
    </li>

    <!-- Language Toggle -->
    <li class="nav-item p-2">
        <div class="language-toggle">
            @{
                var currentUrl = Context.Request.Path + Context.Request.QueryString;
            }

            @if (System.Threading.Thread.CurrentThread.CurrentCulture.Name.StartsWith("ar"))
            {
                <a asp-controller="Culture" asp-action="SetLanguage" asp-route-culture="en"
                   asp-route-returnUrl="@currentUrl" class="btn toggle-lang active">
                    عربي
                </a>
            }
            else
            {
                <a asp-controller="Culture" asp-action="SetLanguage" asp-route-culture="ar"
                   asp-route-returnUrl="@currentUrl" class="btn toggle-lang active">
                    English
                </a>
            }
        </div>
    </li>
</ul>


